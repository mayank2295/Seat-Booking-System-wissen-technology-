<%- include('partials/header') %>

<div class="dashboard-header">
  <h1>Admin Panel</h1>
  <p class="subtitle"><i class="fas fa-shield-halved"></i> Manage employees, monitor bookings &amp; leaves</p>
</div>

<!-- Overview Stats -->
<div class="stats-grid">
  <div class="card stat-card">
    <div class="stat-icon stat-icon-purple"><i class="fas fa-rotate"></i></div>
    <div class="stat-label">Rotation Week</div>
    <div class="stat-value">W<%= weekNumber %></div>
  </div>
  <div class="card stat-card">
    <div class="stat-icon stat-icon-blue"><i class="fas fa-users"></i></div>
    <div class="stat-label">Batch 1 Days</div>
    <div class="stat-value stat-small"><%= batch1Schedule %></div>
  </div>
  <div class="card stat-card">
    <div class="stat-icon stat-icon-blue"><i class="fas fa-user-group"></i></div>
    <div class="stat-label">Batch 2 Days</div>
    <div class="stat-value stat-small"><%= batch2Schedule %></div>
  </div>
  <div class="card stat-card">
    <div class="stat-icon stat-icon-blue"><i class="fas fa-chair"></i></div>
    <div class="stat-label">Total Seats</div>
    <div class="stat-value"><%= totalSeats %></div>
  </div>
  <div class="card stat-card">
    <div class="stat-icon stat-icon-yellow"><i class="fas fa-bookmark"></i></div>
    <div class="stat-label">Booked Today</div>
    <div class="stat-value"><%= bookedSeats %></div>
  </div>
  <div class="card stat-card">
    <div class="stat-icon stat-icon-green"><i class="fas fa-check-circle"></i></div>
    <div class="stat-label">Available</div>
    <div class="stat-value text-success"><%= availableSeats %></div>
  </div>
  <div class="card stat-card">
    <div class="stat-icon stat-icon-red"><i class="fas fa-plane-departure"></i></div>
    <div class="stat-label">On Leave</div>
    <div class="stat-value"><%= leaveCount %></div>
  </div>
</div>

<!-- Seat Availability Progress -->
<div class="card">
  <h2><i class="fas fa-chart-bar"></i> Seat Overview</h2>
  <div class="progress-section">
    <div class="progress-header">
      <span><%= bookedSeats %> of <%= totalSeats %> seats occupied</span>
      <strong><%= availableSeats %> available</strong>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" style="width: <%= totalSeats > 0 ? Math.round((bookedSeats / totalSeats) * 100) : 0 %>%"></div>
    </div>
  </div>
  <div class="seat-grid">
    <% for (let i = 1; i <= totalSeats; i++) { %>
      <div class="seat-dot <%= i <= bookedSeats ? 'seat-dot-booked' : 'seat-dot-available' %>" title="S-<%= String(i).padStart(2, '0') %>"></div>
    <% } %>
  </div>
  <div class="seat-legend">
    <span><span class="legend-dot legend-dot-available"></span> Available</span>
    <span><span class="legend-dot legend-dot-booked"></span> Booked</span>
  </div>
</div>

<!-- Add Employee Form -->
<div class="card">
  <h2><i class="fas fa-user-plus"></i> Add Employee</h2>
  <form action="/admin/add-user" method="POST" class="form-inline-grid">
    <div class="form-group">
      <label for="name"><i class="fas fa-user"></i> Full Name</label>
      <input type="text" id="name" name="name" placeholder="John Doe" required>
    </div>
    <div class="form-group">
      <label for="email"><i class="fas fa-envelope"></i> Email</label>
      <input type="email" id="email" name="email" placeholder="john@company.com" required>
    </div>
    <div class="form-group">
      <label for="password"><i class="fas fa-lock"></i> Password</label>
      <input type="password" id="password" name="password" placeholder="Set a password" required>
    </div>
    <div class="form-group">
      <label for="batch"><i class="fas fa-layer-group"></i> Batch</label>
      <select id="batch" name="batch" required>
        <option value="">Select Batch</option>
        <option value="1">Batch 1</option>
        <option value="2">Batch 2</option>
      </select>
    </div>
    <div class="form-group form-action">
      <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Employee</button>
    </div>
  </form>
</div>

<!-- Two Column: Bookings + Leaves -->
<div class="admin-grid">
  <!-- Today's Bookings -->
  <div class="card">
    <h2><i class="fas fa-calendar-check"></i> Bookings &middot; <%= today %> <span class="badge badge-regular"><%= bookings.length %></span></h2>
    <% if (bookings.length === 0) { %>
      <p class="text-muted"><i class="fas fa-inbox"></i> No bookings for today.</p>
    <% } else { %>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th><i class="fas fa-chair"></i> Seat</th>
              <th><i class="fas fa-user"></i> Employee</th>
              <th><i class="fas fa-envelope"></i> Email</th>
              <th><i class="fas fa-layer-group"></i> Batch</th>
            </tr>
          </thead>
          <tbody>
            <% bookings.forEach(function(b) { %>
              <tr>
                <td><strong><%= b.seat_number %></strong></td>
                <td><%= b.user_name %></td>
                <td><%= b.user_email %></td>
                <td><span class="badge badge-floating">B<%= b.batch %></span></td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <!-- Today's Leaves -->
  <div class="card">
    <h2><i class="fas fa-plane-departure"></i> Leaves &middot; Today <span class="badge badge-regular"><%= leaveCount %></span></h2>
    <% if (leaves.length === 0) { %>
      <p class="text-muted"><i class="fas fa-inbox"></i> No leaves declared for today.</p>
    <% } else { %>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th><i class="fas fa-user"></i> Employee</th>
              <th><i class="fas fa-envelope"></i> Email</th>
              <th><i class="fas fa-layer-group"></i> Batch</th>
            </tr>
          </thead>
          <tbody>
            <% leaves.forEach(function(l) { %>
              <tr>
                <td><%= l.user_name %></td>
                <td><%= l.user_email %></td>
                <td><span class="badge badge-floating">B<%= l.batch %></span></td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>
</div>

<!-- Employee List -->
<div class="card">
  <h2><i class="fas fa-users-rectangle"></i> All Employees <span class="badge badge-regular"><%= users.length %></span></h2>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th><i class="fas fa-user"></i> Name</th>
          <th><i class="fas fa-envelope"></i> Email</th>
          <th><i class="fas fa-layer-group"></i> Batch</th>
          <th><i class="fas fa-tag"></i> Role</th>
          <th><i class="fas fa-gear"></i> Action</th>
        </tr>
      </thead>
      <tbody>
        <% users.forEach(function(u) { %>
          <tr>
            <td><strong><%= u.name %></strong></td>
            <td><%= u.email %></td>
            <td><%= u.batch === 0 ? '—' : 'Batch ' + u.batch %></td>
            <td><span class="badge badge-<%= u.role %>"><%= u.role %></span></td>
            <td>
              <% if (u.role !== 'admin') { %>
                <form action="/admin/delete-user" method="POST" class="inline-form">
                  <input type="hidden" name="userId" value="<%= u.id %>">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Remove this employee?')"><i class="fas fa-trash"></i> Remove</button>
                </form>
              <% } else { %>
                <span class="text-muted">—</span>
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  </div>
</div>

<%- include('partials/footer') %>
